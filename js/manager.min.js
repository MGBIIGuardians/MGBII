tribe.events=tribe.events||{},tribe.events.views=tribe.events.views||{},tribe.events.views.manager={},function(e,t,r){"use strict";var n=e(window);r.selectors={container:'[data-js="tribe-events-view"]',form:'[data-js="tribe-events-view-form"]',link:'[data-js="tribe-events-view-link"]',dataScript:'[data-js="tribe-events-view-data"]',loader:".tribe-events-view-loader",loaderText:".tribe-events-view-loader__text",hiddenElement:".tribe-common-a11y-hidden"},r.lastLocation={origin:"",pathname:""},r.doingPopstate=!1,r.currentAjaxRequest=null,r.$lastContainer=e(),r.$containers=e(),r.cleanup=function(t){var n=e(t),a=n.find(r.selectors.form),i=n.find(r.selectors.dataScript),o={};i.length&&(o=JSON.parse(i.text().trim())),n.trigger("beforeCleanup.tribeEvents",[n,o]),n.find(r.selectors.link).off("click.tribeEvents",r.onLinkClick),a.length&&a.off("submit.tribeEvents",r.onSubmit),n.trigger("afterCleanup.tribeEvents",[n,o])},r.setup=function(t,n){var a=e(n),i=a.find(r.selectors.form),o=a.find(r.selectors.dataScript),s={};o.length&&(s=JSON.parse(o.text().trim())),a.trigger("beforeSetup.tribeEvents",[t,a,s]),a.find(r.selectors.link).on("click.tribeEvents",r.onLinkClick),i.length&&i.on("submit.tribeEvents",r.onSubmit),a.trigger("afterSetup.tribeEvents",[t,a,s])},r.getContainer=function(t){var n=e(t);return n.is(r.selectors.container)?n:n.parents(r.selectors.container).eq(0)},r.getContainerData=function(e){var t=e.find(r.selectors.dataScript);if(t.length)return JSON.parse(t.text().trim())},r.shouldManageUrl=function(e){var t=e.data("view-manage-url");return void 0===t||/^(true|1|on|yes)$/.test(String(t))},r.updateUrl=function(e){if(!r.doingPopstate&&r.shouldManageUrl(e)){var n=e.find(r.selectors.dataScript);if(n.length){var a=JSON.parse(n.text().trim());t.isObject(a)&&(t.isUndefined(a.url)||t.isUndefined(a.title)||(document.title=a.title,window.history.pushState(null,a.title,a.url),r.lastLocation.pathname=document.location.pathname,r.lastLocation.origin=document.location.origin))}}},r.onLinkClick=function(t){var n=r.getContainer(this);n.trigger("beforeOnLinkClick.tribeEvents",t),t.preventDefault();var a=r.getContainerData(n),i=e(this),o=i.attr("href"),s=a.prev_url,l=i.data("view-rest-nonce"),c=r.shouldManageUrl(n),u=n.data("view-shortcode");l||(l=n.data("view-rest-nonce"));var d={prev_url:encodeURI(decodeURI(s)),url:encodeURI(decodeURI(o)),should_manage_url:c,_wpnonce:l};return u&&(d.shortcode=u),r.request(d,n),n.trigger("afterOnLinkClick.tribeEvents",t),!1},r.onSubmit=function(t){var n=r.getContainer(this);n.trigger("beforeOnSubmit.tribeEvents",t),t.preventDefault();var a=e(this),i=n.data("view-rest-nonce"),o={view_data:Qs.parse(a.serialize())["tribe-events-views"],_wpnonce:i};return r.request(o,n),n.trigger("afterOnSubmit.tribeEvents",t),!1},r.onPopState=function(e){var t=e.originalEvent.target,n=t.location.href,a=r.getLastContainer();if(r.lastLocation.origin===t.location.origin&&r.lastLocation.pathname===t.location.pathname)return!1;if(r.lastLocation.pathname=document.location.pathname,r.lastLocation.origin=document.location.origin,!a)return!1;r.currentAjaxRequest&&r.currentAjaxRequest.abort(),r.doingPopstate=!0,a.trigger("beforePopState.tribeEvents",e);var i={url:n,_wpnonce:a.data("view-rest-nonce")};return r.request(i,a),!1},r.setupRequestData=function(t,n){var a=r.shouldManageUrl(n),i=r.getContainerData(n);t.url||(t.url=i.url),t.prev_url||(t.prev_url=i.prev_url),t.should_manage_url=a;var o=n.data("tribeRequestData");return e.isPlainObject(o)?e.extend(o,t):t},r.request=function(t,n){n.trigger("beforeRequest.tribeEvents",[t,n]);var a=r.getAjaxSettings(n);a.data=r.setupRequestData(t,n),r.currentAjaxRequest=e.ajax(a),n.trigger("afterRequest.tribeEvents",[t,n])},r.getAjaxSettings=function(e){return{url:e.data("view-rest-url"),method:e.data("view-rest-method")||"POST",async:!0,beforeSend:r.ajaxBeforeSend,complete:r.ajaxComplete,success:r.ajaxSuccess,error:r.ajaxError,context:e}},r.ajaxBeforeSend=function(e,t){var n=this.find(r.selectors.loader);if(this.trigger("beforeAjaxBeforeSend.tribeEvents",[e,t]),n.length){n.removeClass(r.selectors.hiddenElement.className());var a=n.find(r.selectors.loaderText);a.text(a.text())}this.attr("aria-busy","true"),this.trigger("afterAjaxBeforeSend.tribeEvents",[e,t])},r.ajaxComplete=function(e,t){var n=this.find(r.selectors.loader);this.trigger("beforeAjaxComplete.tribeEvents",[e,t]),n.length&&n.addClass(r.selectors.hiddenElement.className()),this.trigger("afterAjaxComplete.tribeEvents",[e,t]),r.doingPopstate&&(r.doingPopstate=!1),r.currentAjaxRequest=null},r.ajaxSuccess=function(t,n,a){var i=this;i.trigger("beforeAjaxSuccess.tribeEvents",[t,n,a]);var o=e(t);r.cleanup(i),document.dispatchEvent(new CustomEvent("containerReplaceBefore.tribeEvents",{detail:i})),i.replaceWith(o),i=o,r.setup(0,i),document.dispatchEvent(new CustomEvent("containerReplaceAfter.tribeEvents",{detail:i})),r.selectContainers(),r.updateUrl(i),i.trigger("afterAjaxSuccess.tribeEvents",[t,n,a]),r.shouldManageUrl(i)&&(r.$lastContainer=i)},r.ajaxError=function(e,t){this.trigger("beforeAjaxError.tribeEvents",[e,t]),this.trigger("afterAjaxError.tribeEvents",[e,t])},r.selectContainers=function(){return r.$containers=e(r.selectors.container),r.$containers},r.getLastContainer=function(){return r.$lastContainer.length||(r.$lastContainer=r.$containers.filter('[data-view-manage-url="1"]').eq(0)),r.$lastContainer},r.ready=function(){r.selectContainers().each(r.setup),r.lastLocation={origin:document.location.origin,pathname:document.location.pathname}},e(r.ready),n.on("popstate",r.onPopState)}(jQuery,window.underscore||window._,tribe.events.views.manager);